# dim(分布式即时通讯框架)

基于swoole扩展，实现傻瓜式添加服务器、启动服务，即可针对IM进行随意扩容。

支持功能：

1. 自动加入server集群（最少一台）
2. 集群选举
3. 服务状态、存活检查
4. 数据转发、用户分组
5. 就近服务器连接
6. 宕机服务剔除


#问题
1. 3机房，内网故障，
2. 选举时间因为在线机器n*300ms(内网一次交互)
3. 选举有效期同上
4. leader需要保持额外的socket连接，用于连接各follower（可以采用默认所有server都预留）




# 设计

## 公共

* 广播时间 （10+n）ms
* 选举超时 （0.5-5) s
* 服务器宕机时间 3 min

## 角色

1. leader 领导者
2. follower 跟随者
3. candidate 候选者

## 流程

1. 服务启动
2. 查找集群查找leader（无启动leader则默认自己为leader）
3. 通过leader安全认证
4. 更新检查（新启动服务包含新的代码、配置，需要首先同步到leader）
5. leader确认服务加入集群
6. leader通知集群同步最新更新

# 消息模式

1. 回复（客户端发起，服务端返回）
2. 转发（客户端发起，服务转发，发送到另外一个客户端）
3. 群发（客户端发起，服务转发，发送到指定客户端）